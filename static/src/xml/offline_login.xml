<?xml version="1.0" encoding="UTF-8"?>
<templates id="template" xml:space="preserve">

    <!-- Offline Login Popup - Odoo 19 Dialog Pattern -->
    <!-- SIMPLIFIED v2: Uses same password as Odoo login (no separate PIN) -->
    <!-- Note: No brute-force lockout - users can retry indefinitely (product decision) -->
    <t t-name="PDCPOSOffline.OfflineLoginPopup">
        <Dialog title="dialogTitle" size="'md'">
            <div class="pdc-offline-login-popup">
                <div class="popup-header mb-3">
                    <div class="offline-indicator badge bg-warning">
                        <i class="fa fa-wifi-slash me-1"/> Offline Mode
                    </div>
                </div>

                <div class="popup-body">
                    <div class="alert alert-info mb-3">
                        <i class="fa fa-info-circle me-2"/>
                        No internet connection. Enter your password to continue offline.
                    </div>

                    <!-- Warning when no users are cached -->
                    <t t-if="state.cachedUsers.length === 0">
                        <div class="alert alert-warning mb-3">
                            <i class="fa fa-exclamation-triangle me-2"/>
                            No users available for offline login. At least one user must log in while online first.
                        </div>
                    </t>

                    <div class="mb-3">
                        <label class="form-label">Username</label>
                        <!-- Show dropdown if cached users exist, text input otherwise -->
                        <t t-if="state.cachedUsers.length > 0">
                            <select class="form-control" t-model="state.username">
                                <option value="">-- Select User --</option>
                                <t t-foreach="state.cachedUsers" t-as="user" t-key="user.id">
                                    <option t-att-value="user.login" t-esc="user.name + ' (' + user.login + ')'"/>
                                </t>
                            </select>
                        </t>
                        <t t-else="">
                            <input type="text"
                                   class="form-control"
                                   t-model="state.username"
                                   t-att-readonly="props.username ? 'readonly' : undefined"
                                   placeholder="Enter username"/>
                            <div class="form-text text-warning">No cached users found. You must log in online first.</div>
                        </t>
                    </div>

                    <div class="mb-3">
                        <label class="form-label">Password</label>
                        <input type="password"
                               class="form-control"
                               t-model="state.password"
                               placeholder="Enter your password"
                               t-on-keyup="onPasswordKeyup"
                               autofocus="autofocus"/>
                        <div class="form-text">Use your regular Odoo login password</div>
                    </div>

                    <t t-if="state.error">
                        <div class="alert alert-danger">
                            <i class="fa fa-exclamation-triangle me-2"/>
                            <t t-esc="state.error"/>
                        </div>
                    </t>

                    <t t-if="state.isLoading">
                        <div class="text-center py-3">
                            <i class="fa fa-spinner fa-spin fa-2x"/>
                            <p class="mt-2 text-muted">Authenticating...</p>
                        </div>
                    </t>
                </div>

                <div class="popup-footer d-flex justify-content-end gap-2 mt-3">
                    <button class="btn btn-secondary" t-on-click="cancel">
                        <i class="fa fa-times me-1"/>
                        <t t-esc="props.cancelText or 'Cancel'"/>
                    </button>
                    <button class="btn btn-primary"
                            t-on-click="authenticate"
                            t-att-disabled="!canAuthenticate or state.isLoading">
                        <i class="fa fa-sign-in me-1"/>
                        <t t-esc="props.confirmText or 'Login Offline'"/>
                    </button>
                </div>
            </div>
            <t t-set-slot="footer"/>
        </Dialog>
    </t>

</templates>
