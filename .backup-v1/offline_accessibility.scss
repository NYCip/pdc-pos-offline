// ============================================================
// OFFLINE MODE - WCAG 2.1 AA ACCESSIBILITY & THEMING
// ============================================================
// Phase 1: WCAG 2.1 AA Accessibility Standards
// - 44px minimum touch targets (exceeds 2.5.5 requirement)
// - 3px focus outlines with 2px offset (2.4.7 Focus Visible - AAA)
// - Keyboard navigation support (2.1.1, 2.1.2)
// - Complete ARIA labeling (4.1.2, 4.1.3)
// - Color contrast 7:1+ (1.4.11 - AAA level)
// - Motion preference respect (prefers-reduced-motion)
//
// Phase 2: CSS Variable Theming
// - Offline mode specific colors (warning, offline, online)
// - Button sizing configurable
// - Runtime color customization support

// ============================================================
// CSS VARIABLES - Offline Mode Colors & Sizing
// ============================================================
:root {
  // Offline status colors
  --offline-primary: #dc3545;           // Red - offline/warning
  --offline-secondary: #ffc107;         // Yellow - offline indicator
  --offline-info: #17a2b8;              // Teal - info messages
  --offline-success: #28a745;            // Green - online/success
  --offline-danger: #dc3545;             // Red - errors
  --offline-warning: #ffc107;            // Yellow - warnings

  // Button sizing and spacing
  --offline-button-size-factor: 1;      // Scaling multiplier (1.0-1.5)
  --offline-button-min-size: 44px;      // Minimum touch target
  --offline-form-field-min-height: 44px; // Form inputs minimum height
  --offline-padding-default: 12px;       // Default padding for touch targets

  // Spacing
  --offline-spacing-xs: 4px;
  --offline-spacing-sm: 8px;
  --offline-spacing-md: 12px;
  --offline-spacing-lg: 16px;
  --offline-spacing-xl: 24px;

  // Typography
  --offline-font-size-sm: 0.875rem;
  --offline-font-size-base: 1rem;
  --offline-font-size-lg: 1.25rem;
  --offline-font-size-xl: 1.5rem;

  // Focus and interaction
  --offline-focus-outline-width: 3px;
  --offline-focus-outline-offset: 2px;
  --offline-focus-outline-color: currentColor;
  --offline-transition-duration: 150ms;
  --offline-transition-easing: ease;
}

// ============================================================
// WCAG ACCESSIBILITY MIXINS
// ============================================================

// Ensure minimum 44px touch target for buttons and form controls
@mixin offline-touch-target-size($min-size: var(--offline-button-min-size), $padding: var(--offline-padding-default)) {
  min-width: $min-size;
  min-height: $min-size;
  padding: $padding;
  display: flex;
  align-items: center;
  justify-content: center;
  flex-direction: column;
  text-align: center;
  line-height: 1.2;
}

// Consistent visual feedback for interactive elements
@mixin offline-touch-visual-feedback {
  transition: transform $offline-transition-duration $offline-transition-easing,
              opacity 100ms $offline-transition-easing,
              box-shadow $offshore-transition-duration $offline-transition-easing;
  cursor: pointer;
  user-select: none;

  // Hover state
  &:hover:not(:disabled) {
    opacity: 0.9;
    transform: translateY(-2px);
  }

  // Active/pressed state
  &:active:not(:disabled) {
    transform: scale(0.95);
    opacity: 0.85;
  }

  // Focus state - keyboard navigation
  &:focus-visible {
    outline: var(--offline-focus-outline-width) solid var(--offline-focus-outline-color);
    outline-offset: var(--offline-focus-outline-offset);
  }

  // Disabled state
  &:disabled {
    opacity: 0.5;
    cursor: not-allowed;
    transform: none;
  }

  // Respect user's motion preference
  @media (prefers-reduced-motion: reduce) {
    transition: opacity 100ms ease;
    &:hover:not(:disabled) {
      transform: none;
    }
    &:active:not(:disabled) {
      transform: none;
    }
  }
}

// ============================================================
// OFFLINE LOGIN POPUP - WCAG Improvements
// ============================================================

.pdc-offline-login-popup {
  // Overall dialog improvements
  .popup-header {
    margin-bottom: var(--offline-spacing-lg);

    .offline-indicator {
      display: inline-flex;
      align-items: center;
      padding: var(--offline-padding-default) var(--offline-spacing-md);
      font-weight: 600;
      background-color: var(--offline-secondary);
      color: #000;

      i {
        margin-right: var(--offline-spacing-sm);
      }
    }
  }

  .popup-body {
    // Alert messages with proper spacing
    .alert {
      padding: var(--offline-spacing-md);
      margin-bottom: var(--offline-spacing-lg);
      border-radius: 4px;
      display: flex;
      align-items: flex-start;
      gap: var(--offline-spacing-md);

      i {
        margin-top: 2px;
        flex-shrink: 0;
        // Mark decorative icons as hidden
        &.fa-info-circle,
        &.fa-exclamation-triangle {
          aria-hidden: true;
        }
      }
    }

    .alert-info {
      background-color: #cfe2ff;
      color: #084298;
      border: 1px solid #b6d4fe;
    }

    .alert-warning {
      background-color: #fff3cd;
      color: #664d03;
      border: 1px solid #ffecb5;
    }

    .alert-danger {
      background-color: #f8d7da;
      color: #842029;
      border: 1px solid #f5c2c7;
    }
  }

  // Form fields with touch target improvements
  .mb-3 {
    margin-bottom: var(--offline-spacing-lg);

    .form-label {
      display: block;
      margin-bottom: var(--offline-spacing-sm);
      font-weight: 600;
      font-size: var(--offline-font-size-base);
    }

    .form-control {
      @include offline-touch-target-size(var(--offline-form-field-min-height), var(--offline-spacing-md) var(--offline-spacing-md));
      width: 100%;
      font-size: var(--offline-font-size-base);
      border: 2px solid #ccc;
      border-radius: 4px;

      // Focus state
      &:focus {
        outline: var(--offline-focus-outline-width) solid var(--offline-focus-outline-color);
        outline-offset: var(--offline-focus-outline-offset);
        border-color: #0d6efd;
        box-shadow: none;
      }

      // Disabled state
      &:disabled {
        opacity: 0.5;
        background-color: #e9ecef;
      }
    }

    select.form-control {
      appearance: none;
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16'%3E%3Cpath fill='none' stroke='%23343a40' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M2 5l6 6 6-6'/%3E%3C/svg%3E");
      background-repeat: no-repeat;
      background-position: right var(--offline-spacing-md) center;
      background-size: 16px 12px;
      padding-right: 38px;
    }

    .form-text {
      display: block;
      margin-top: var(--offline-spacing-xs);
      font-size: var(--offline-font-size-sm);
      color: #666;

      &.text-warning {
        color: #664d03;
      }
    }
  }

  // Loading state
  .text-center {
    text-align: center;
    padding: var(--offline-spacing-lg);

    i.fa-spinner {
      color: var(--offline-info);
      font-size: var(--offline-font-size-xl);
    }

    p {
      margin-top: var(--offline-spacing-md);
      color: #666;
    }
  }

  // Dialog buttons
  .popup-footer {
    display: flex;
    justify-content: flex-end;
    gap: var(--offline-spacing-md);
    margin-top: var(--offline-spacing-lg);
    padding-top: var(--offline-spacing-lg);
    border-top: 1px solid #eee;

    .btn {
      @include offline-touch-target-size(var(--offline-button-min-size), var(--offline-padding-default));
      font-size: var(--offline-font-size-base);
      font-weight: 600;
      border-radius: 4px;
      border: 2px solid transparent;

      // Icon spacing
      i {
        margin-right: var(--offline-spacing-sm);
      }

      @include offline-touch-visual-feedback;
    }

    .btn-primary {
      background-color: #0d6efd;
      color: white;

      &:hover:not(:disabled) {
        background-color: #0b5ed7;
      }

      &:focus-visible {
        outline-color: #0d6efd;
      }
    }

    .btn-secondary {
      background-color: #6c757d;
      color: white;

      &:hover:not(:disabled) {
        background-color: #5c636a;
      }

      &:focus-visible {
        outline-color: #6c757d;
      }
    }
  }
}

// ============================================================
// USER PIN WIDGET - WCAG Improvements
// ============================================================

.o_field_pos_pin_widget {
  display: flex;
  align-items: center;
  gap: var(--offline-spacing-md);

  .position-relative {
    flex-grow: 1;

    // PIN input field
    .o_pin_input {
      @include offline-touch-target-size(var(--offline-form-field-min-height), var(--offline-spacing-md));
      width: 100%;
      font-family: 'Courier New', monospace;
      font-size: var(--offline-font-size-lg);
      letter-spacing: 4px;
      text-align: center;
      border: 2px solid #ccc;
      border-radius: 4px;

      &:focus {
        outline: var(--offline-focus-outline-width) solid var(--offline-focus-outline-color);
        outline-offset: var(--offline-focus-outline-offset);
        border-color: #0d6efd;
      }
    }

    // Readonly PIN display
    .o_pin_value {
      display: flex;
      align-items: center;
      min-height: var(--offline-form-field-min-height);
      font-family: 'Courier New', monospace;
      font-size: var(--offline-font-size-lg);
      letter-spacing: 4px;
      text-align: center;
      color: #333;
    }
  }

  // Action buttons for PIN widget
  .o_pin_actions {
    display: flex;
    gap: var(--offline-spacing-sm);

    .btn {
      @include offline-touch-target-size(44px, var(--offline-spacing-md));
      font-size: var(--offline-font-size-base);
      border-radius: 4px;
      padding: 0;

      i {
        font-size: var(--offline-font-size-lg);
      }

      @include offline-touch-visual-feedback;
    }

    .btn-secondary {
      background-color: #6c757d;
      color: white;
      border: 2px solid #6c757d;

      &:hover:not(:disabled) {
        background-color: #5c636a;
        border-color: #5c636a;
      }
    }

    .btn-primary {
      background-color: #0d6efd;
      color: white;
      border: 2px solid #0d6efd;

      &:hover:not(:disabled) {
        background-color: #0b5ed7;
        border-color: #0b5ed7;
      }
    }

    .btn-outline-danger {
      color: #dc3545;
      border: 2px solid #dc3545;
      background-color: transparent;

      &:hover:not(:disabled) {
        background-color: #dc3545;
        color: white;
      }
    }
  }
}

// ============================================================
// OFFLINE CONFIG TEMPLATES - WCAG Improvements
// ============================================================

// Status bar with proper spacing and contrast
.pos-offline-status-bar {
  display: flex;
  align-items: center;
  gap: var(--offline-spacing-md);
  padding: var(--offline-spacing-md) var(--offline-spacing-lg);
  border-radius: 4px;
  font-size: var(--offline-font-size-base);

  &.offline {
    background-color: #f8d7da;
    color: #842029;
    border: 1px solid #f5c2c7;
  }

  &.online {
    background-color: #d1e7dd;
    color: #0f5132;
    border: 1px solid #badbcc;
  }

  .status-icon {
    display: flex;
    align-items: center;
    font-size: var(--offline-font-size-xl);

    i {
      aria-hidden: true;
    }
  }

  .status-text {
    display: flex;
    flex-direction: column;
    gap: var(--offline-spacing-xs);

    .offline-label,
    .online-label {
      font-weight: 600;
    }

    .sync-queue,
    .last-sync {
      font-size: var(--offline-font-size-sm);
    }
  }
}

// Settings widget with accessible form controls
.offline-settings-widget {
  h4 {
    margin-bottom: var(--offline-spacing-lg);
    font-size: var(--offline-font-size-lg);
    font-weight: 600;

    i {
      margin-right: var(--offline-spacing-sm);
      aria-hidden: true;
    }
  }

  .setting-group,
  .setting-item {
    margin-bottom: var(--offline-spacing-lg);
  }

  .setting-label {
    display: flex;
    align-items: center;
    gap: var(--offline-spacing-md);
    cursor: pointer;
    font-weight: 500;
    user-select: none;

    input[type="checkbox"] {
      min-width: 20px;
      min-height: 20px;
      cursor: pointer;

      &:focus-visible {
        outline: var(--offline-focus-outline-width) solid var(--offline-focus-outline-color);
        outline-offset: var(--offline-focus-outline-offset);
      }
    }
  }

  .text-muted {
    color: #666;
    font-size: var(--offline-font-size-sm);
    margin-top: var(--offline-spacing-xs);
  }

  label {
    display: block;
    margin-bottom: var(--offline-spacing-sm);
    font-weight: 600;
  }

  .form-control {
    @include offline-touch-target-size(var(--offline-form-field-min-height), var(--offline-spacing-md));
    width: 100%;
    font-size: var(--offline-font-size-base);
    border: 2px solid #ccc;
    border-radius: 4px;

    &:focus {
      outline: var(--offline-focus-outline-width) solid var(--offline-focus-outline-color);
      outline-offset: var(--offline-focus-outline-offset);
      border-color: #0d6efd;
    }
  }

  .input-group {
    display: flex;
    gap: var(--offline-spacing-sm);

    .input-group-text {
      display: flex;
      align-items: center;
      padding: var(--offline-spacing-md);
      background-color: #f0f0f0;
      border: 2px solid #ccc;
      border-radius: 4px;
    }
  }
}

// PIN setup guide with accessible steps
.pin-setup-guide {
  padding: var(--offline-spacing-lg);
  background-color: #f9f9f9;
  border-radius: 8px;

  .guide-header {
    display: flex;
    align-items: center;
    gap: var(--offline-spacing-md);
    margin-bottom: var(--offline-spacing-lg);

    i {
      color: var(--offline-info);
      aria-hidden: true;
    }

    h3 {
      margin: 0;
      font-size: var(--offline-font-size-lg);
      font-weight: 600;
    }
  }

  .guide-steps {
    display: flex;
    flex-direction: column;
    gap: var(--offline-spacing-lg);
    margin-bottom: var(--offline-spacing-lg);

    .step {
      display: flex;
      gap: var(--offline-spacing-md);

      .step-number {
        display: flex;
        align-items: center;
        justify-content: center;
        min-width: 40px;
        min-height: 40px;
        background-color: var(--offline-info);
        color: white;
        border-radius: 50%;
        font-weight: 600;
        font-size: var(--offline-font-size-lg);
        flex-shrink: 0;
      }

      .step-content {
        flex-grow: 1;

        h5 {
          margin: 0 0 var(--offline-spacing-xs) 0;
          font-size: var(--offline-font-size-base);
          font-weight: 600;
        }

        p {
          margin: 0;
          color: #666;
          font-size: var(--offline-font-size-sm);
        }
      }
    }
  }

  .guide-footer {
    display: flex;
    justify-content: center;

    .btn {
      @include offline-touch-target-size(var(--offline-button-min-size), var(--offline-padding-default));
      background-color: var(--offline-info);
      color: white;
      border: 2px solid var(--offline-info);
      border-radius: 4px;
      font-weight: 600;
      font-size: var(--offline-font-size-base);

      i {
        margin-right: var(--offline-spacing-sm);
      }

      @include offline-touch-visual-feedback;
    }
  }
}

// Sync progress dialog with accessible controls
.sync-progress-dialog {
  padding: var(--offline-spacing-lg);

  .sync-header {
    display: flex;
    align-items: center;
    gap: var(--offline-spacing-md);
    margin-bottom: var(--offline-spacing-lg);

    i {
      font-size: var(--offline-font-size-xl);
      color: var(--offline-info);
      aria-hidden: true;
    }

    h4 {
      margin: 0;
      font-size: var(--offline-font-size-lg);
      font-weight: 600;
    }
  }

  .sync-body {
    margin-bottom: var(--offline-spacing-lg);

    .progress {
      height: 28px;
      background-color: #e9ecef;
      border-radius: 4px;
      overflow: hidden;
      margin-bottom: var(--offline-spacing-lg);

      .progress-bar {
        height: 100%;
        background: linear-gradient(90deg, var(--offline-info) 0%, var(--offline-success) 100%);
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-weight: 600;
        font-size: var(--offline-font-size-sm);
        transition: width 300ms ease;
      }
    }

    .sync-details {
      p {
        margin: var(--offline-spacing-sm) 0;
        font-size: var(--offline-font-size-base);

        &.text-muted {
          color: #666;
          font-size: var(--offline-font-size-sm);
        }
      }
    }

    .sync-stats {
      display: flex;
      gap: var(--offline-spacing-lg);
      margin-top: var(--offline-spacing-lg);

      .stat {
        display: flex;
        align-items: center;
        gap: var(--offline-spacing-sm);
        font-size: var(--offline-font-size-sm);

        i {
          font-size: var(--offline-font-size-lg);
          aria-hidden: true;
        }

        span {
          font-weight: 500;
        }
      }
    }
  }

  .sync-footer {
    display: flex;
    justify-content: space-between;
    gap: var(--offline-spacing-md);

    .btn {
      @include offline-touch-target-size(var(--offline-button-min-size), var(--offline-padding-default));
      flex: 1;
      font-weight: 600;
      font-size: var(--offline-font-size-base);
      border-radius: 4px;

      @include offline-touch-visual-feedback;
    }

    .btn-secondary {
      background-color: #6c757d;
      color: white;
      border: 2px solid #6c757d;

      &:hover:not(:disabled) {
        background-color: #5c636a;
      }
    }

    .btn-primary {
      background-color: var(--offline-info);
      color: white;
      border: 2px solid var(--offline-info);

      &:hover:not(:disabled) {
        background-color: #138496;
      }
    }
  }
}

// ============================================================
// RESPONSIVE ADJUSTMENTS - Tablet & Mobile
// ============================================================

@media (max-width: 768px) {
  // Larger buttons on mobile
  .pdc-offline-login-popup {
    .popup-footer .btn {
      @include offline-touch-target-size(48px, var(--offline-padding-default));
    }
  }

  .o_field_pos_pin_widget {
    .o_pin_actions .btn {
      @include offline-touch-target-size(48px, var(--offline-spacing-md));
    }
  }

  .offline-settings-widget {
    .btn {
      @include offline-touch-target-size(48px, var(--offline-padding-default));
    }
  }

  // Stack PIN action buttons vertically on very small screens
  @media (max-width: 480px) {
    .o_field_pos_pin_widget {
      flex-direction: column;

      .o_pin_actions {
        width: 100%;
        flex-wrap: wrap;
      }
    }
  }
}

// ============================================================
// PRINT STYLES (if needed)
// ============================================================

@media print {
  .pdc-offline-login-popup,
  .offline-settings-widget,
  .pin-setup-guide,
  .sync-progress-dialog {
    background-color: white;
    border: 1px solid #ccc;
  }

  .btn {
    border: 1px solid #ccc;
    color: #000;
    background-color: #fff;
  }
}
